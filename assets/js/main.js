
/* ================================
   ÙƒØ§Ø¦Ù† Ø§Ù„ØªØ±Ø¬Ù…Ø§Øª Ø¨Ø§Ù„Ù„ØºØªÙŠÙ† (Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠØ© / Ø¹Ø±Ø¨ÙŠØ©)
================================ */
const translations = {
  en: {
    title_home: "City Events Guide",
    title_events: "Events - City Events Guide",
    title_event: "Event Details - City Events Guide",
    title_about: "About - City Events Guide",
    title_contact: "Contact - City Events Guide",
    brand: "City Events",
    rights: "Â© 2025 City Events â€” All rights reserved.",
    nav_home: "Home",
    nav_events: "Events",
    nav_about: "About",
    nav_contact: "Contact",
    featured: "Featured This Week",
    categories: "Categories",
    latest: "Latest Events",
    all: "All Categories",
    about_title: "About City Events",
    about_text: "City Events is a simple guide made for the course. It helps local people find activities, cultural events, sports and more.",
    team: "Team",
    role_prof1: "Home Page Programming",
    role_prof2: "Events Page Programming & Event Details Page",
    role_prof3: "About Page Programming & Contact Page",
    contact_title: "Contact Us",
    label_name: "Name",
    label_email: "Email",
    label_message: "Message",
    send: "Send"
  },
  ar: {
    title_home: "Ø¯Ù„ÙŠÙ„ ÙØ¹Ø§Ù„ÙŠØ§Øª Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©",
    title_events: "Ø§Ù„ÙØ¹Ø§Ù„ÙŠØ§Øª - Ø¯Ù„ÙŠÙ„ ÙØ¹Ø§Ù„ÙŠØ§Øª Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©",
    title_event: "ØªÙØ§ØµÙŠÙ„ Ø§Ù„ÙØ¹Ø§Ù„ÙŠØ© - Ø¯Ù„ÙŠÙ„ ÙØ¹Ø§Ù„ÙŠØ§Øª Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©",
    title_about: "Ø­ÙˆÙ„ Ø§Ù„Ø¯Ù„ÙŠÙ„",
    title_contact: "Ø§ØªØµÙ„ Ø¨Ù†Ø§",
    brand: "Ø¯Ù„ÙŠÙ„ Ø§Ù„ÙØ¹Ø§Ù„ÙŠØ§Øª",
    rights: "Â© 2025 Ø¯Ù„ÙŠÙ„ ÙØ¹Ø§Ù„ÙŠØ§Øª Ø§Ù„Ù…Ø¯ÙŠÙ†Ø© â€” ÙƒÙ„ Ø§Ù„Ø­Ù‚ÙˆÙ‚ Ù…Ø­ÙÙˆØ¸Ø©.",
    nav_home: "Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©",
    nav_events: "Ø§Ù„ÙØ¹Ø§Ù„ÙŠØ§Øª",
    nav_about: "Ø¹Ù† Ø§Ù„Ø¯Ù„ÙŠÙ„",
    nav_contact: "Ø§ØªØµÙ„ Ø¨Ù†Ø§",
    featured: "Ø§Ù„ÙØ¹Ø§Ù„ÙŠØ§Øª Ø§Ù„Ø¨Ø§Ø±Ø²Ø© Ù‡Ø°Ø§ Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹",
    categories: "Ø§Ù„ØªØµÙ†ÙŠÙØ§Øª",
    latest: "Ø£Ø­Ø¯Ø« Ø§Ù„ÙØ¹Ø§Ù„ÙŠØ§Øª",
    all: "Ø¬Ù…ÙŠØ¹ Ø§Ù„ØªØµÙ†ÙŠÙØ§Øª",
    about_title: "Ø¹Ù† Ø¯Ù„ÙŠÙ„ Ø§Ù„ÙØ¹Ø§Ù„ÙŠØ§Øª",
    about_text: "Ø¯Ù„ÙŠÙ„ ÙØ¹Ø§Ù„ÙŠØ§Øª Ø§Ù„Ù…Ø¯ÙŠÙ†Ø© Ù‡Ùˆ Ù…Ø´Ø±ÙˆØ¹ ØªØ¹Ù„ÙŠÙ…ÙŠ ÙŠØ³Ø§Ø¹Ø¯ Ø§Ù„Ù…Ø¬ØªÙ…Ø¹ ÙÙŠ Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø§Ù„ÙØ¹Ø§Ù„ÙŠØ§Øª Ø§Ù„Ù…Ø­Ù„ÙŠØ©.",
    team: "Ø§Ù„ÙØ±ÙŠÙ‚",
    role_prof1: "Ø¨Ø±Ù…Ø¬Ø© ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©",
    role_prof2: "Ø¨Ø±Ù…Ø¬Ø© ØµÙØ­Ø© Ø§Ù„ÙØ¹Ø§Ù„ÙŠØ§Øª Ùˆ ØµÙØ­Ø© ØªÙØ§ØµÙŠÙ„ Ø§Ù„ÙØ¹Ø§Ù„ÙŠØ©",
    role_prof3: "Ø¨Ø±Ù…Ø¬Ø© ØµÙØ­Ø© Ø­ÙˆÙ„ Ùˆ ØµÙØ­Ø© Ø§ØªØµÙ„ Ø¨Ù†Ø§",
    contact_title: "ØªÙˆØ§ØµÙ„ Ù…Ø¹Ù†Ø§",
    label_name: "Ø§Ù„Ø§Ø³Ù…",
    label_email: "Ø§Ù„Ø¨Ø±ÙŠØ¯",
    label_message: "Ø§Ù„Ø±Ø³Ø§Ù„Ø©",
    send: "Ø¥Ø±Ø³Ø§Ù„"
  }
};

/* ================================
   Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„ÙØ¹Ø§Ù„ÙŠØ§Øª Ù…Ø¹ Ø¨ÙŠØ§Ù†Ø§ØªÙ‡Ø§
================================ */
const events = [
  {
    "id": 1,
    "title_en": "Riyadh Season â€“ Boulevard City",
    "title_ar": "Ù…ÙˆØ³Ù… Ø§Ù„Ø±ÙŠØ§Ø¶ â€“ Ø¨ÙˆÙ„ÙŠÙØ§Ø±Ø¯ Ø³ÙŠØªÙŠ ",
    "date": "2025-10-10",
    "category": "Festival",
    "place": "Boulevard City, Riyadh",
    "img": "assets/img/riyadh_season.jpg",
    "description_en": "Riyadh Season is a months-long entertainment festival featuring concerts, shows, sporting events and family attractions across multiple zones in the city.",
    "description_ar": "Ù…ÙˆØ³Ù… Ø§Ù„Ø±ÙŠØ§Ø¶ Ù…Ù‡Ø±Ø¬Ø§Ù† ØªØ±ÙÙŠÙ‡ÙŠ ÙŠØ³ØªÙ…Ø± Ù„Ø¹Ø¯Ø© Ø£Ø´Ù‡Ø± ÙˆÙŠØ¶Ù… Ø­ÙÙ„Ø§ØªØŒ Ø¹Ø±ÙˆØ¶Ù‹Ø§ØŒ ÙØ¹Ø§Ù„ÙŠØ§Øª Ø±ÙŠØ§Ø¶ÙŠØ© ÙˆØ£Ù†Ø´Ø·Ø© Ø¹Ø§Ø¦Ù„ÙŠØ© ÙÙŠ Ø¹Ø¯Ø© Ù…Ù†Ø§Ø·Ù‚ Ø¨Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©."
  },
  {
    "id": 2,
    "title_en": "Noor Riyadh â€“ Light Art Festival",
    "title_ar": "Ù†ÙˆØ± Ø§Ù„Ø±ÙŠØ§Ø¶ â€“ Ù…Ù‡Ø±Ø¬Ø§Ù† ÙÙ†ÙˆÙ† Ø§Ù„Ø¥Ø¶Ø§Ø¡Ø©",
    "date": "2025-11-28",
    "category": "Art & Culture",
    "place": "Downtown Riyadh / Multiple Venues",
    "img": "assets/img/noor_riyadh.jpg",
    "description_en": "Noor Riyadh is a large-scale light art festival that turns Riyadh into an open-air gallery with immersive light installations and public artworks.",
    "description_ar": "Ù†ÙˆØ± Ø§Ù„Ø±ÙŠØ§Ø¶ Ù…Ù‡Ø±Ø¬Ø§Ù† Ø¶Ø®Ù… Ù„Ø£Ø¹Ù…Ø§Ù„ ÙˆÙÙ†ÙˆÙ† Ø§Ù„Ø¥Ø¶Ø§Ø¡Ø© ÙŠØ­ÙˆÙ‘Ù„ Ø§Ù„Ø±ÙŠØ§Ø¶ Ø¥Ù„Ù‰ Ù…Ø¹Ø±Ø¶ Ù…ÙØªÙˆØ­ Ù…Ø¹ ØªØ±ÙƒÙŠØ¨Ø§Øª Ø¶ÙˆØ¦ÙŠØ© ÙˆØªØ¬Ø§Ø±Ø¨ ÙÙ†ÙŠØ© Ø¹Ø§Ù…Ø©."
  },
  {
    "id": 3,
    "title_en": "SOUNDSTORM â€“ MDLBEAST Music Festival",
    "title_ar": "Ø³Ø§ÙˆÙ†Ø¯Ø³ØªÙˆØ±Ù… â€“ Ù…Ù‡Ø±Ø¬Ø§Ù† MDLBEAST Ø§Ù„Ù…ÙˆØ³ÙŠÙ‚ÙŠ",
    "date": "2025-12-12",
    "category": "Music",
    "place": "Banban, Riyadh",
    "img": "assets/img/soundstorm.webp",
    "description_en": "SOUNDSTORM is a major 3-day music festival in Riyadh featuring international and regional artists across multiple stages.",
    "description_ar": "Ø³Ø§ÙˆÙ†Ø¯Ø³ØªÙˆØ±Ù… Ù…Ù‡Ø±Ø¬Ø§Ù† Ù…ÙˆØ³ÙŠÙ‚ÙŠ Ø¶Ø®Ù… ÙŠØ³ØªÙ…Ø± Ø«Ù„Ø§Ø«Ø© Ø£ÙŠØ§Ù… ÙˆÙŠØ³ØªØ¶ÙŠÙ ÙÙ†Ø§Ù†ÙŠÙ† Ù…Ø­Ù„ÙŠÙŠÙ† ÙˆØ¹Ø§Ù„Ù…ÙŠÙŠÙ† Ø¹Ù„Ù‰ Ù…Ø³Ø§Ø±Ø­ Ù…ØªØ¹Ø¯Ø¯Ø©."
  },
  {
    "id": 4,
    "title_en": "Riyadh International Marathon",
    "title_ar": "Ù…Ø§Ø±Ø§Ø«ÙˆÙ† Ø§Ù„Ø±ÙŠØ§Ø¶ Ø§Ù„Ø¯ÙˆÙ„ÙŠ",
    "date": "2025-02-08",
    "category": "Sports",
    "place": "King Saud University / Riyadh",
    "img": "assets/img/riyadh_marathon.webp",
    "description_en": "The Riyadh Marathon is an annual road race with marathon, half-marathon and shorter distances, promoted as a World Athletics Elite Label Road Race.",
    "description_ar": "Ù…Ø§Ø±Ø§Ø«ÙˆÙ† Ø§Ù„Ø±ÙŠØ§Ø¶ Ø³Ø¨Ø§Ù‚ Ø·Ø±Ù‚ Ø³Ù†ÙˆÙŠ ÙŠØ´Ù…Ù„ Ø§Ù„Ù…Ø§Ø±Ø§Ø«ÙˆÙ† ÙˆØ§Ù„Ù†ØµÙ Ù…Ø§Ø±Ø§Ø«ÙˆÙ† ÙˆÙ…Ø³Ø§ÙØ§Øª Ø£Ù‚ØµØ±ØŒ ÙˆÙ‡Ùˆ Ù…ÙØµÙ†Ù‘Ù ÙƒØ³Ø¨Ø§Ù‚ Ø·Ø±ÙŠÙ‚ Ù…ØªÙ…ÙŠØ² Ù…Ù† Ù‚Ø¨Ù„ Ø§Ù„Ø§ØªØ­Ø§Ø¯ Ø§Ù„Ø¯ÙˆÙ„ÙŠ Ù„Ø£Ù„Ø¹Ø§Ø¨ Ø§Ù„Ù‚ÙˆÙ‰."
  },
  {
    "id": 5,
    "title_en": "Riyadh Comedy Festival (Boulevard City)",
    "title_ar": "Ù…Ù‡Ø±Ø¬Ø§Ù† Ø§Ù„ÙƒÙˆÙ…ÙŠØ¯ÙŠØ§ ÙÙŠ Ø§Ù„Ø±ÙŠØ§Ø¶ (Ø¨ÙˆÙ„ÙŠÙØ§Ø±Ø¯ Ø³ÙŠØªÙŠ)",
    "date": "2025-09-26",
    "category": "Comedy",
    "place": "Boulevard City, Riyadh",
    "img": "assets/img/riyadh_comedy.jpg",
    "description_en": "A large comedy festival featuring international and regional stand-up acts held as part of Riyadh Season programming.",
    "description_ar": "Ù…Ù‡Ø±Ø¬Ø§Ù† ÙƒÙˆÙ…ÙŠØ¯ÙŠØ§ ÙƒØ¨ÙŠØ± ÙŠØ¶Ù… Ø¹Ø±ÙˆØ¶ Ø³ØªØ§Ù†Ø¯ Ø£Ø¨ Ù…Ù† ÙÙ†Ø§Ù†ÙŠÙ† Ù…Ø­Ù„ÙŠÙŠÙ† ÙˆØ¹Ø§Ù„Ù…ÙŠÙŠÙ† ÙƒØ¬Ø²Ø¡ Ù…Ù† ÙØ¹Ø§Ù„ÙŠØ§Øª Ù…ÙˆØ³Ù… Ø§Ù„Ø±ÙŠØ§Ø¶."
  }
];
/* ================================
   Ø§Ù„Ù„ØºØ© Ø§Ù„Ø­Ø§Ù„ÙŠØ© Ù…Ù† LocalStorage Ø£Ùˆ Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ© Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠØ©
================================ */
let currentLang = localStorage.getItem('lang') || 'en';

/* ================================
   Ø¶Ø¨Ø· Ø§ØªØ¬Ø§Ù‡ Ø§Ù„ØµÙØ­Ø© Ø­Ø³Ø¨ Ø§Ù„Ù„ØºØ©
================================ */
function setDirByLang(lang) {
  const html = document.documentElement;
  if (lang === 'ar') { html.setAttribute('dir', 'rtl'); html.setAttribute('lang', 'ar'); }
  else { html.setAttribute('dir', 'ltr'); html.setAttribute('lang', 'en'); }
}

/* ================================
   ØªØ±Ø¬Ù…Ø© Ø§Ù„Ù†ØµÙˆØµ ÙÙŠ Ø§Ù„ØµÙØ­Ø© Ø­Ø³Ø¨ Ø§Ù„Ù„ØºØ©
================================ */
function translatePage() {
  document.querySelectorAll('[data-i18n]').forEach(el => {
    const key = el.getAttribute('data-i18n');
    const txt = translations[currentLang][key];
    if (txt) el.innerText = txt;
  });
  document.title = translations[currentLang]['title_home'] || document.title;
}

/* ================================
   Ø¥Ù†Ø´Ø§Ø¡ Ø¨Ø·Ø§Ù‚Ø© ÙØ¹Ø§Ù„ÙŠØ© ÙˆØ§Ø­Ø¯Ø©
================================ */
function createEventCard(ev) {
  const title = currentLang === 'ar' ? ev.title_ar : ev.title_en;
  const desc = currentLang === 'ar' ? ev.description_ar : ev.description_en;
  return `<div class="col-md-4 mb-4">
    <div class="card h-100">
      <img src="${ev.img}" class="card-img-top" alt="${title}">
      <div class="card-body d-flex flex-column">
        <h5 class="card-title">${title}</h5>
        <p class="text-muted small">${ev.date} â€” ${ev.place}</p>
        <p class="card-text">${desc}</p>
        <div class="mt-auto"><a href="event.html?id=${ev.id}" class="btn btn-sm btn-primary">${currentLang === 'ar' ? 'Ø§Ù„ØªÙØ§ØµÙŠÙ„' : 'Details'}</a></div>
      </div>
    </div>
  </div>`;
}

/* ================================
   ØªÙØ¹ÙŠÙ„ Ø£Ø²Ø±Ø§Ø± Ø§Ù„ØªØµÙ†ÙŠÙØ§Øª (ÙÙ„ØªØ±Ø© Ø§Ù„ÙØ¹Ø§Ù„ÙŠØ§Øª)
================================ */
function attachCategoryButtons() {
  document.querySelectorAll('.cat-btn').forEach(btn => {
    btn.addEventListener('click', () => {
      const selectedCat = btn.getAttribute('data-cat');
      const filtered = selectedCat === 'all' ? events : events.filter(e => e.category === selectedCat);
      document.getElementById('latest-grid').innerHTML = filtered.map(createEventCard).join('');
      document.querySelectorAll('.cat-btn').forEach(b => b.classList.remove('active'));
      btn.classList.add('active');
    });
  });
}

/* ================================
   Ø¹Ø±Ø¶ Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© (Ø§Ù„Ø¹Ø±ÙˆØ¶ + Ø§Ù„ØªØµÙ†ÙŠÙØ§Øª + Ø§Ù„ÙØ¹Ø§Ù„ÙŠØ§Øª)
================================ */
function renderIndex() {
  const carousel = document.getElementById('carousel-inner');
  carousel.innerHTML = events.map((ev, i) => `
    <div class="carousel-item ${i === 0 ? 'active' : ''}">
      <img src="${ev.img}" class="d-block w-100" style="height:300px;object-fit:cover" alt="">
      <div class="carousel-caption d-none d-md-block bg-dark bg-opacity-50 rounded p-2">
        <h5>${currentLang === 'ar' ? ev.title_ar : ev.title_en}</h5>
        <p>${currentLang === 'ar' ? ev.description_ar : ev.description_en}</p>
      </div>
    </div>
  `).join('');

  const cats = Array.from(new Set(events.map(e => e.category)));
  const translatedCats = cats.map(c => currentLang === 'ar' ? translateCategory(c) : c);

  document.getElementById('category-badges').innerHTML = `
    <button class="btn btn-outline-secondary btn-sm me-2 mb-2 cat-btn active" data-cat="all">${translations[currentLang]['all']}</button>
    ${cats.map((c, i) => `<button class="btn btn-outline-secondary btn-sm me-2 mb-2 cat-btn" data-cat="${c}">${translatedCats[i]}</button>`).join('')}
  `;

  document.getElementById('latest-grid').innerHTML = events.map(createEventCard).join('');

  attachCategoryButtons();
}


/* ================================
   ØªØ±Ø¬Ù…Ø© Ø£Ø³Ù…Ø§Ø¡ Ø§Ù„ØªØµÙ†ÙŠÙØ§Øª
================================ */
function translateCategory(cat) {
  const mapping = {
    'Festival': 'Ù…Ù‡Ø±Ø¬Ø§Ù†',
    'Art & Culture': 'Ø§Ù„ÙÙ†ÙˆÙ† ÙˆØ§Ù„Ø«Ù‚Ø§ÙØ©',
    'Music': 'Ù…ÙˆØ³ÙŠÙ‚Ù‰',
    'Sports': 'Ø±ÙŠØ§Ø¶Ø©',
    'Comedy': 'ÙƒÙˆÙ…ÙŠØ¯ÙŠØ§'
  };
  return currentLang === 'ar' ? (mapping[cat] || cat) : cat;
}

/* ================================
   Ø¹Ø±Ø¶ ØµÙØ­Ø© Ø§Ù„ÙØ¹Ø§Ù„ÙŠØ§Øª (Ø¨Ø­Ø« + ØªØµÙÙŠØ©)
================================ */
function renderEventsPage() {
  const filterCat = document.getElementById('filter-category');
  const filterDate = document.getElementById('filter-date');
  const searchInput = document.getElementById('search-input');
  const list = document.getElementById('events-list');

  const cats = Array.from(new Set(events.map(e => e.category)));
  const translatedCats = cats.map(c => currentLang === 'ar' ? translateCategory(c) : c);

  filterCat.innerHTML = `<option value="all">${translations[currentLang]['all']}</option>` +
    cats.map((c, i) => `<option value="${c}">${translatedCats[i]}</option>`).join('');

  function refresh() {
    const catVal = filterCat.value;
    const dateVal = filterDate.value;
    const searchVal = searchInput.value.toLowerCase();

    const filtered = events.filter(e => {
      const matchesCat = catVal === 'all' || e.category === catVal;
      const matchesSearch = (currentLang === 'ar' ? e.title_ar : e.title_en).toLowerCase().includes(searchVal);
      const matchesDate = !dateVal || e.date === dateVal;
      return matchesCat && matchesSearch && matchesDate;
    });

    if (filtered.length > 0)
      list.innerHTML = filtered.map(createEventCard).join('');
    else
      list.innerHTML = `<div class="col-12 text-center text-muted mt-3">${currentLang === 'ar' ? 'Ù„Ø§ ØªÙˆØ¬Ø¯ ÙØ¹Ø§Ù„ÙŠØ§Øª Ù„Ù‡Ø°Ø§ Ø§Ù„ØªØ§Ø±ÙŠØ®' : 'No events found for this date.'}</div>`;
  }

  searchInput.addEventListener('input', refresh);
  filterCat.addEventListener('change', refresh);
  filterDate.addEventListener('change', refresh);

  refresh();
}

/* ================================
   ØµÙØ­Ø© ØªÙØ§ØµÙŠÙ„ Ø§Ù„ÙØ¹Ø§Ù„ÙŠØ©
================================ */
function renderEventDetails() {
  const params = new URLSearchParams(location.search);
  const id = Number(params.get('id')) || events[0].id;
  const ev = events.find(e => e.id === id) || events[0];
  const title = currentLang === 'ar' ? ev.title_ar : ev.title_en;
  const desc = currentLang === 'ar' ? ev.description_ar : ev.description_en;

  document.getElementById('event-details').innerHTML = `
    <div class="card">
      <div class="row g-0">
        <div class="col-md-6">
          <img src="${ev.img}" class="img-fluid rounded-start" alt="">
        </div>
        <div class="col-md-6">
          <div class="card-body">
            <h2>${title}</h2>
            <p class="text-muted">${ev.date} â€” ${ev.place}</p>
            <p>${desc}</p>
            <div class="mb-2">
              <button id="share-btn" class="btn btn-outline-primary btn-sm">${currentLang === 'ar' ? 'Ø´Ø§Ø±Ùƒ' : 'Share'}</button>
              <button id="calendar-btn" class="btn btn-primary btn-sm">${currentLang === 'ar' ? 'Ø£Ø¶Ù Ù„Ù„ØªÙ‚ÙˆÙŠÙ…' : 'Add to Calendar'}</button>
            </div>
            
            </div>
          </div>
        </div>
      </div>
    </div>
  `;

  document.getElementById('share-btn').addEventListener('click', () => {
    const shareData = { title, text: desc, url: window.location.href };
    if (navigator.share) navigator.share(shareData).catch(err => console.log('Error sharing:', err));
    else { navigator.clipboard.writeText(window.location.href); alert(currentLang === 'ar' ? 'ØªÙ… Ù†Ø³Ø® Ø§Ù„Ø±Ø§Ø¨Ø·' : 'Link copied to clipboard'); }
  });

  document.getElementById('calendar-btn').addEventListener('click', () => {
    const start = new Date(ev.date).toISOString().replace(/-|:|\.\d\d\d/g, "");
    const end = new Date(new Date(ev.date).getTime() + 60 * 60 * 1000).toISOString().replace(/-|:|\.\d\d\d/g, "");
    const url = `https://www.google.com/calendar/render?action=TEMPLATE&text=${encodeURIComponent(title)}&dates=${start}/${end}&details=${encodeURIComponent(desc)}&location=${encodeURIComponent(ev.place)}`;
    window.open(url, '_blank');
  });
}

/* ================================
   Ù†Ù…ÙˆØ°Ø¬ ØµÙØ­Ø© Ø§ØªØµÙ„ Ø¨Ù†Ø§
================================ */
function initContactForm() {
  const form = document.getElementById('contact-form');
  const alertPlace = document.getElementById('alert-placeholder');

  function showAlert(message, type = 'success') {
    alertPlace.innerHTML = `
      <div class="alert alert-${type} alert-dismissible fade show" role="alert">
        ${message}
        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
      </div>`;
    setTimeout(() => { const bsAlert = bootstrap.Alert.getOrCreateInstance(alertPlace.querySelector('.alert')); bsAlert.close(); }, 3000);
  }

  form.addEventListener('submit', (e) => {
    e.preventDefault();
    const name = (document.getElementById('name')?.value || '').trim();
    const email = (document.getElementById('email')?.value || '').trim();
    const message = (document.getElementById('message')?.value || '').trim();

    if (!name || !email || !message) { showAlert(currentLang === 'ar' ? 'Ø§Ù„Ø±Ø¬Ø§Ø¡ Ù…Ù„Ø¦ ÙƒÙ„ Ø§Ù„Ø­Ù‚ÙˆÙ„' : 'Please fill all fields.', 'danger'); return; }
    const emailPattern = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
    if (!emailPattern.test(email)) { showAlert(currentLang === 'ar' ? 'Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø¨Ø±ÙŠØ¯ ØµØ­ÙŠØ­' : 'Please provide a valid email.', 'danger'); return; }
    showAlert(currentLang === 'ar' ? 'ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø±Ø³Ø§Ù„Ø© Ø¨Ù†Ø¬Ø§Ø­' : 'Message sent successfully.', 'success');
    form.reset();
  });
}

function attachLangButtons() {
  document.querySelectorAll('.lang-btn').forEach(btn => {
    btn.addEventListener('click', () => {
      currentLang = btn.getAttribute('data-lang');
      localStorage.setItem('lang', currentLang);
      applyLanguageToPage();
    });
  });
}

/* ================================
   ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ù„ØºØ© Ø§Ù„Ù…Ø®ØªØ§Ø±Ø© Ø¹Ù„Ù‰ Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ©
================================ */
function applyLanguageToPage() {
  setDirByLang(currentLang);
  document.querySelectorAll('[data-i18n]').forEach(el => {
    const key = el.getAttribute('data-i18n');
    if (translations[currentLang][key]) el.innerText = translations[currentLang][key];
  });
  const page = window.__PAGE__;
  if (page === 'index') renderIndex();
  if (page === 'events') renderEventsPage();
  if (page === 'event') renderEventDetails();
  const tKey = page === 'index' ? 'title_home' : page === 'events' ? 'title_events' : page === 'event' ? 'title_event' : page === 'about' ? 'title_about' : page === 'contact' ? 'title_contact' : 'title_home';
  if (translations[currentLang][tKey]) document.title = translations[currentLang][tKey];
}

/* ================================
   ØªÙ‡ÙŠØ¦Ø© Ø§Ù„ØµÙØ­Ø© Ø¹Ù†Ø¯ Ø§Ù„ØªØ­Ù…ÙŠÙ„
================================ */
function initPage(pageName) {
  window.__PAGE__ = pageName;
  attachLangButtons();
  applyLanguageToPage();
  if (pageName === 'contact') { initContactForm(); }
}

setDirByLang(currentLang);

/* ================================
   ÙˆØ¶Ø¹ Ø§Ù„Ø¯Ø§ÙƒÙ† (Dark Mode)
================================ */
function initDarkMode() {
  const darkToggle = document.getElementById('darkModeToggle');
  const body = document.body;

  // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ù…Ø­ÙÙˆØ¸ Ù…Ø³Ø¨Ù‚Ø§Ù‹
  if (localStorage.getItem('theme') === 'dark') {
    body.classList.add('dark-mode');
    updateDarkButton(true);
  }

  // Ø¹Ù†Ø¯ Ø§Ù„Ø¶ØºØ· Ø¹Ù„Ù‰ Ø§Ù„Ø²Ø±
  if (darkToggle) {
    darkToggle.addEventListener('click', () => {
      body.classList.toggle('dark-mode');
      const isDark = body.classList.contains('dark-mode');
      localStorage.setItem('theme', isDark ? 'dark' : 'light');
      updateDarkButton(isDark);
    });
  }
}

function updateDarkButton(isDark) {
  const btn = document.getElementById('darkModeToggle');
  if (!btn) return;
  btn.textContent = isDark ? 'â˜€ï¸' : 'ğŸŒ™';
}
document.addEventListener('DOMContentLoaded', initDarkMode);
